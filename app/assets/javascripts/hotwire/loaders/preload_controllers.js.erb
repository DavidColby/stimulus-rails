async function preloadControllers() {
  const imports = await fetch("<%= asset_path "hotwire/importmap.json" %>").then(r => r.json()).then(json => json.imports)

  for (const name in imports) {
    if (name.startsWith("controllers/")) {
      let controllerName = name.replace(/controllers\//, "").replace("_controller", "")

      import(imports[name]).then((module) => {
        Stimulus.register(controllerName, module.default)
      }).catch(error => console.log(error))
    }
  }
}

preloadControllers()
